<% title "#{server.name} Map", "#{server.game.name} Server #{server.id}" %>
<% layout :maps %>

<%= track_landing_type :map %>

<% provide(:foo_bar) do %>
  <div class="navbar-text">
    Back to
    <%= link_to(server.name, server_path(server)) %>
  </div>
<% end %>

<div id="map-view-el" class="map-view"></div>

<% if server.world and server.world.mapped? %>
  <% content_for :tail do %>
    <%= javascript_include_tag '//maps.google.com/maps/api/js?sensor=false' %>
    <script>
      app.map = new App.Map(<%= render(partial: 'servers/maps/map', locals: {map: server.world}, :format => :json).html_safe %>);
    </script>
    <script>
    app.mapView = new App.MapView({model: app.map});
      $(document).ready(function() {
        app.mapView.setElement($('#map-view-el'));
        app.mapView.render();
      });
    </script>
  <% end %>
<% else %>
  <center class="container" style="margin-top:40px;width:400px">
    <p>
      The map for <a href="<%= server_path(server) %>"><%= server.name %></a> hasn't been rendered yet. Maps are rendered once a day when nobody is playing. Render times depend on the size of your world.
    </p>
  </center>
<% end %>
