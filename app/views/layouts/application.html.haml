!!!
%html{'xmlns:og' => 'http://ogp.me/ns#', id: page_css_selector}
  %head
    %meta{charset: 'utf-8'}
    = stylesheet_link_tag 'application'

    %title
      - if content_for? :title
        = content_for(:title)
        â€”
      Minefold

    /
      \
      \ /'\_/`\  __                  /'___\     /\_ \     /\ \
      \/\      \/\_\    ___      __ /\ \__/  ___\//\ \    \_\ \
      \\ \ \__\ \/\ \ /' _ `\  /'__`\ \ ,__\/ __`\\ \ \   /'_` \
      \ \ \ \_/\ \ \ \/\ \/\ \/\  __/\ \ \_/\ \L\ \\_\ \_/\ \L\ \
      \  \ \_\\ \_\ \_\ \_\ \_\ \____\\ \_\\ \____//\____\ \___,_\
      \   \/_/ \/_/\/_/\/_/\/_/\/____/ \/_/ \/___/ \/____/\/__,_ /

    %meta{name:'description', content:'Play Minecraft on demand with friends.'}
    %meta{name:'keywords', content:%w(gaming games game minecraft server hosting multiplayer).join(',')}
    = favicon_link_tag

    %meta{'http-equiv' => 'X-UA-Compatible', :content => 'IE=edge,chrome=1'}
    %meta{name: 'viewport', content: 'width=device-width, initial-scale=1'}
    %meta{property: 'og:site_name', content: 'Minefold'}
    %meta{property: 'fb:app_id', content: ENV['FB_APP_ID']}
    = csrf_meta_tags

    = javascript_include_tag '//d3ds63zw57jt09.cloudfront.net/1.10/pusher.min.js'
    = javascript_include_tag '//maps.google.com/maps/api/js?sensor=false'

    /[if lt IE 9]
      = javascript_include_tag '//html5shim.googlecode.com/svn/trunk/html5.js'

    = render partial: 'shared/mixpanel'
    = render partial: 'shared/exceptional'

    = javascript_include_tag 'application'

    = yield :head

  %body{lang: 'en'}

    #backside= yield :backside

    %header
      .container
        %h1
          = link_to root_url do
            Minefold
            %em Beta!

        %ol#nav
          - if not user_signed_in?
            %li.nav-pricing= link_to 'Pricing', pricing_page_path
            %li.nav-blog= link_to 'Blog', 'http://blog.minefold.com'

            %li.nav-signin= link_to 'Sign In', new_user_session_path
            %li.nav-signup= link_to 'Sign Up', new_user_path

          - else
            %li.nav-dashboard= link_to 'Dashboard', user_root_path
            %li.nav-photos= link_to 'Photos', photos_path
            - if current_user.photos.unsorted.count > 0
              %li.nav-lightroom
                = link_to lightroom_path do
                  Lightroom
                  %span.count= current_user.photos.unsorted.count

            %li.nav-user
              = link_to current_user do
                = avatar_tag current_user, :small, width: 20, height: 20

              %ol
                %li.nav-profile= link_to 'Profile', current_user
                %li.nav-settings= link_to 'Settings', account_path
                %li.nav-sign-out= link_to 'Sign out', destroy_user_session_path, method: :delete

            %li.nav-plan
              - if current_user.pro?
                %span.pro Pro!
              - else
                #{current_user.hours_left}h left
                = link_to pro_account_path, class: 'upgrade' do
                  Upgrade to Pro


        :javascript
          var userMenuView = new Mf.UserMenuView({el: $('header #nav .nav-user')});

    - if flash.any?
      #flash
        - flash.each do |type, message|
          %div.message{class: type}
            %a.hide{href: '#'} Hide
            = simple_format(message)

      :javascript
        // Manual hide
        $('#flash a.hide').click(function() { $(this).parent().hide(); });

        // Staggers multiple messages from hiding.
        var t = 2000;

        // Timeout hide
        $('#flash .message').each(function(i){
          var elm = $(this);
          // Counts the number of words in the message, giving 600ms to read each word.
          t += (elm.text().split(/\s+/).length * 600) + (i * 300);
          delay(t, function(){ elm.slideUp(); });
        });

    #masthead
      .container= yield :masthead

    #page
      .container
        = yield

    %footer
      .container
        %ul
          %li.about= link_to 'About', about_page_path
          %li.help= link_to 'Help', help_page_path
          %li.blog= link_to 'Blog', 'http://blog.minefold.com'
          %li.feedback= link_to 'Feedback', 'http://getsatisfaction.com/minefold'
          -# %li.press= link_to 'Press', press_page_path
          -# %li.jobs= link_to 'Jobs', jobs_page_path
          %li.fineprint.privacy= link_to 'Privacy', privacy_page_path
          %li.fineprint.terms= link_to 'Terms', terms_page_path

          %li.social.twitter= link_to 'Facebook', 'https://facebook.com/minefold'
          %li.social.twitter= link_to 'Twitter', 'https://twitter.com/minefold'

    - if Rails.env.production?
      = render partial: 'shared/analytics'
