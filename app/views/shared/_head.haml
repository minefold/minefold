%meta{charset: 'utf-8'}
= stylesheet_link_tag 'application'

%title
  - if content_for?(:title)
    = content_for(:title)
    â€”
  Minefold


/ ---


%meta{name: 'description', content: 'Play Minecraft on demand with friends.'}
%meta{name: 'keywords', content: %w(gaming games game minecraft server hosting multiplayer).join(',')}
= favicon_link_tag

%meta{'http-equiv' => 'X-UA-Compatible', :content => 'IE=edge,chrome=1'}
%meta{name: 'viewport', content: 'width=device-width, initial-scale=1'}

%meta{property: 'og:site_name', content: 'Minefold'}
%meta{property: 'fb:app_id', content: ENV['FB_APP_ID']}

%meta{name: 'pusher:key', content: Pusher.key}
= csrf_meta_tags


/ ---


- # Crashm.at
- if Rails.env.production?
  :javascript
    var _crashmat = #{crashmat_options.to_json};
    (function(w, d, cm, woe) {
    w.onerror = function(e,f,l) {
    cm.e = cm.e || []; cm.e.push([e,f,l]);
    if (woe) woe(e,f,l);
    };
    var e = d.createElement('script');
    e.async = true;
    e.src = '//db2uk9yp28y61.cloudfront.net/';
    (d.head || d.getElementsByTagName('head')[0]).appendChild(e);
    })(window, document, window._crashmat, window.onerror);g

/ = javascript_include_tag "//use.typekit.com/#{ENV['TYPEKIT_ID']}.js"
= javascript_include_tag '//d3ds63zw57jt09.cloudfront.net/1.10/pusher.min.js'
= render partial: 'shared/mixpanel'

/[if lt IE 9]
  = javascript_include_tag '//html5shim.googlecode.com/svn/trunk/html5.js'

:javascript
  try{Typekit.load();}catch(e){}

- js do
  %script(src="//connect.facebook.net/en_US/all.js")
  %script
    FB.init({appId: #{ENV['FB_APP_ID'].to_i.to_json}, status: true, cookie: true});

    #{ yield :facebook }

  - if Rails.env.production?
    = render partial: 'shared/analytics'

- js do
  - if Rails.env.production? and signed_in?
    %script#IntercomSettingsScriptTag
      :plain
        var intercomSettings = {
          app_id: '8oc9zbvo',
          email: '#{current_user.email}',
          created_at: #{current_user.created_at.to_i},
          user_hash: '#{Digest::SHA1.hexdigest('kczzht6c' + current_user.email)}',
          custom_data: #{current_user.tracking_data.to_json}
        };

        #{ yield :intercom }

    :javascript
      (function() {
        function async_load() {
          var s = document.createElement('script');
          s.type = 'text/javascript'; s.async = true;
          s.src = 'https://api.intercom.io/api/js/library.js';
          var x = document.getElementsByTagName('script')[0];
          x.parentNode.insertBefore(s, x);
        }
        if (window.attachEvent) {
          window.attachEvent('onload', async_load);
        } else {
          window.addEventListener('load', async_load, false);
        }
      })();

= yield :head
