= form_for new_user do |f|
  .errors
    - unless new_user.errors.empty?
      %p
        Whoops a daisy! Your:
      %ol
        - new_user.errors.each do |key, desc|
          %li
            %strong= key
            = desc

  - if referrer
    %section.referral
      %p You've been referred by #{referrer.username}

  %section
    = f.label :username, 'Minecraft Username'
    = f.text_field :username, tabindex: 1, placeholder: 'notch'
    :coffeescript
      username = $('input#user_username')
      fetchUser = ->
        u = username.val()
        if u isnt ''
          $.getJSON '/signup/check', {username: u}, (data, status) ->
              username.siblings('.hint').toggle(not data.paid)

      username.keyup _.debounce(fetchUser, 300)

    .hint{hidden}
      %p
        You need a <em>paid</em> Minecraft account to play on Minefold. They are â‚¬14.95 at #{link_to 'http://minecraft.net/store', 'http://minecraft.net/store', target: '_blank'}.

  %section
    = f.label :email
    = f.email_field :email, tabindex:2, value: new_user.email || '', placeholder: 'notch@mojang.com'

  %section
    = f.label :password, 'Choose a password'
    = f.password_field :password, tabindex: 3

    = f.label :password_confirmation, 'Confirm password'
    = f.password_field :password_confirmation, tabindex: 4

  %section
    = f.submit 'Start playing now'
    .spinner{hidden}
