= render partial: 'header'
= render partial: 'plan'

#packs
  %p
    = form_tag customer_charge_path, method: :post do
      = hidden_field_tag :hours, 10
      %button Buy 10 hours for $2.95

  %p= link_to 'buy 40 hours for $7.95'
  %p= link_to 'buy 120 hours for $11.95'

#plans
  = form_tag customer_subscription_path, method: :put do
    = hidden_field_tag :plan_id, 'small'
    %button Small Plan

  = form_tag customer_subscription_path, method: :put do
    = hidden_field_tag :plan_id, 'medium'
    %button Medium Plan


  %table
    %thead
      %tr
        %th
        %th Price
        %th Hours / mo
        %th Worlds

    %tbody
      / - Plan.all.sort_by {|plan| plan.price}.reverse.each do |plan|
      /   %tr{class: plan.stripe_id}
      /     %th.name= plan.name
      /     %td.price= number_to_currency(plan.price.to_f / 100)
      /     %td.hours= plan.credits / 60
      /     %td.worlds= plan.worlds
      /     %td.change
      /       - if current_user.plan == plan.stripe_id
      /         Current plan
      /       - else
      /         - action = plan_change_action(current_user, plan)
      /         = button_to action, plan_account_path(plan_id: plan.stripe_id), method: :put, confirm: "Are you sure you want to #{action.downcase}?", class: 'button'


#card
  = image_tag 'card.png'
  - if current_user.card.nil?
    %p No card on file
  - else
    %p
      %strong Card on file:
      = current_user.card.type

