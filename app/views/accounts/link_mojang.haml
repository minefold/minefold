.minecraft-link-state.pull-left.is-unlinked
  .state-icon
  %p.unlinked Waiting for link
  %p.linked Linked
  %p.already-linked
    %strong.username chrislloyd
    %br
    is already linked

.minecraft-link-instructions
  %p
    Open Minecraft, click “Multiplayer” then “Direct Connect” and enter the following server address:
    %br
    %code.highlight= current_user.minecraft_link_host

= render partial: 'funpacks/getting_started/minecraft_connect', locals: { address: current_user.minecraft_link_host }

:css
  .minecraft-link-state {
    width: 140px;
    margin-right: 20px;
    font-size: 12px;
    color: #999;
    text-align: center;
  }

  .minecraft-link-state .state-icon {
    background-image: url('/assets/spinner-big.gif');
    background-repeat: no-repeat;
    background-position: 50% 50%;
    width: 32px;
    height: 32px;
    margin: 0 auto;
    margin-bottom: 10px;
  }

  .minecraft-link-state .unlinked,
  .minecraft-link-state .linked,
  .minecraft-link-state .already-linked {
    display: none;
  }

  .minecraft-link-state.is-unlinked .unlinked {
    display: block;
  }

  .minecraft-link-state.is-linked .linked {
    display: block;
    color: #2a4;
  }

  .minecraft-link-state.is-already-linked .already-linked {
    display: block;
    color: #d31;
  }

  .minecraft-link-state.is-linked .state-icon {
    background-color: #2a4;
    background-image: url('/assets/icons/tick.png');
  }

  .minecraft-link-state.is-already-linked .state-icon {
    background-color: #d31;
    background-image: url('/assets/icons/warning.png');
  }

:javascript
  var onLinked = function(data) {
    $('.minecraft-link-state')
      .removeClass('is-unlinked')
      .addClass('is-linked');

    setTimeout(function(){
      window.location.reload();
    }, 4000);
  };

  var onAlreadyLinked = function(data) {
    $('.minecraft-link-state')
      .removeClass('is-unlinked')
      .addClass('is-already-linked')
      .find('.username').text(data.username);
  }

  $(document).ready(function() {
    var channel = app.currentUser.chan;
    channel.bind('linked', onLinked);
    channel.bind('alreadyLinked', onAlreadyLinked);
  });

